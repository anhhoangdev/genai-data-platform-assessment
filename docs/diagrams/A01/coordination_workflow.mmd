```mermaid
flowchart LR
  %% Terraform -> Ansible Coordination Workflow (Phases 0-4)

  subgraph TF["Terraform"]
    P0["Phase 0: Foundation Security\n- Enable APIs\n- KMS/CMEK\n- WIF (GitHub â†” GCP)\n- Org Policies"]
    P1["Phase 1: Infra Provision\n- VPC & Subnets\n- Bastion VM\n- FreeIPA VM\n- Filestore\n- Workstation MIG"]
  end

  subgraph ANS["Ansible"]
    P2A["Phase 2A: Bastion Config\n- Common base\n- IAP SSH hardening\n- NFS tools"]
    P2B["Phase 2B: FreeIPA Config\n- Server install\n- Realm setup\n- PAM/SSSD policies"]
    P2C["Phase 2C: Workstation Config\n- Join to IPA\n- autofs NFS home\n- Dev tools (Code-server/JupyterLab)"]
  end

  subgraph P3["Phase 3: Production Hardening"]
    P3A["Security Audit"]
    P3B["Performance Testing"]
    P3C["Monitoring Setup"]
    P3D["Backup Strategy"]
    P3E["DR Testing"]
  end

  subgraph P4["Phase 4: Onboarding & Docs"]
    P4A["Admin Accounts"]
    P4B["Test Accounts"]
    P4C["Access Validation"]
    P4D["Documentation"]
    P4E["Training"]
  end

  %% Edges and Dependencies
  P0 --> P1
  P1 --> P2A
  P1 --> P2B
  P1 --> P2C

  %% Parallelizable Steps (Phase 2 sub-branches)
  P2A --> P3A
  P2C --> P3B
  P2C --> P3C
  P2C --> P3D
  P3D --> P3E

  %% Completion & Finalization
  P3A --> P4A
  P3A --> P4D
  P2B --> P4B
  P4A --> P4B --> P4C --> P4E

  %% Notes: Terraform drives infra; Ansible drives config
  TF -. orchestrates .-> ANS
```


